{% extends 'base.html' %}
{% load static %}
{% block simulator_content %}

<div class="container mt-4">
    <!-- Configuration Section -->
    {% include 'simulator_config.html' %}

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100" style="display: none;">
        <div class="position-absolute top-50 start-50 translate-middle text-center">
            <div class="spinner-border text-primary mb-2" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div>Running simulation...</div>
        </div>
    </div>

    <!-- Simulation Results -->
    <div id="simulation-results" style="display: none;" class="mt-4">
        <h3>Simulation Results</h3>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Lineup</th>
                        <th class="text-end">Win %</th>
                        <th class="text-end">ROI %</th>
                        <th class="text-end">Top 10%</th>
                        <th class="text-end">Cash %</th>
                        <th class="text-end">Avg Points</th>
                    </tr>
                </thead>
                <tbody id="results-body">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Lineup Navigation and Actions -->
    <div class="d-flex justify-content-between align-items-center my-3">
        <!-- Navigation Buttons -->
        <div>
            <button class="btn btn-navigation" id="prev-lineup" disabled>
                <i class="fas fa-chevron-left"></i> Previous
            </button>
            <button class="btn btn-navigation" id="next-lineup">
                Next <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <!-- Lineup Counter -->
        <div>
            Lineup <span id="current-lineup">1</span> of <span id="total-lineups">0</span>
        </div>

        <!-- Action Buttons -->
        <div>
            <button class="btn btn-secondary" id="reupload-btn">
                <i class="fas fa-upload"></i> Re-upload Files
            </button>
            <a href="#" class="btn btn-secondary" id="download-csv" style="display: none;">
                <i class="fas fa-download"></i> Download CSV
            </a>
        </div>
    </div>

    <!-- Single Lineup Display -->
    <div id="lineups-section" style="display: none;">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Position</th>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Opponent</th>
                        <th>Salary</th>
                        <th>Proj. Pts</th>
                        <th>Own %</th>
                    </tr>
                </thead>
                <tbody id="lineup-body">
                </tbody>
            </table>
        </div>

        <!-- Lineup Summary -->
        <div class="lineup-summary mt-3">
            <div class="row">
                <div class="col-md-3">
                    <strong>Total Salary:</strong> <span id="total-salary">$0</span>
                </div>
                <div class="col-md-3">
                    <strong>Projected Points:</strong> <span id="total-projected">0</span>
                </div>
                <div class="col-md-3">
                    <strong>Stack:</strong> <span id="lineup-stack">-</span>
                </div>
                <div class="col-md-3">
                    <strong>Ownership Sum:</strong> <span id="ownership-sum">0%</span>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Load config handling first -->
<script src="{% static 'js/simulator-config.js' %}"></script>
<!-- Then load lineup handling -->
<script src="{% static 'js/simulator-lineups.js' %}"></script>
{% endblock %}
